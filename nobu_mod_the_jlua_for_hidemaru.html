%(hilight)s
<div class="content-box mb-3 content-lighten">
<h2><i class="fa fa-dedent fa-fw"></i>秀丸用、jLuaのインテリセンスな実行・開発環境<br>
(秀丸エディタ v8.00以上用)</h2>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>概要</h3>
    <p>jLuaHMは、秀丸上で「文字コードsjis(cp932)」のLuaを作成するのに適した環境を <br>
    構築するためのファイル群です。 <br>
    <br>
    日本語MS-Windows環境でのLua言語の学習や編集する際に役立つ、インテリセンス環境です。 <br>
    <br>
    又、同時に、 <br>
    秀丸エディタを、強力なインテリセンスエディタとする方法を理解するための、 <br>
    ミニマムなサンプル ともなっています。 <br>
    </p>
    <ol>
        <li><b>入力支援</b></li>
        <li><b>強調表示</b></li>
        <li><b>構造ツリーの自動分析</b></li>
        <li><b>Luaファイルの即時実行と、タグジャンプ可能なエラー出力</b></li>
        <li><b>Luaファイルの単体での事前syntaxチェック(実行チェックではなく、コンパイル可能かのチェック)</b></li>
        <li><b>単体のLuaファイルをexe化する。</b></li>
    </ol>
    <p>等が可能となっています。</p>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>ダウンロード</h3>

	  <div class="card mb-3 ml-3" style="max-width: 30rem;">
	    <div class="card-body text-center">
              <div class="row">
              <div class="col-12"><small>更新日 %(year)04d/%(mon)02d/%(mday)02d</small></div>
              </div>
	      <a href="%(file)s" class="btn btn-primary"><i class="fa fa-download fa-fw"></i>jLuaHM.zip ver 1.001</a>
	    </div>
	  </div>

</div>
<div class="content-box mb-3 content-lighten">
    <h3>環境設定</h3>
    <ul class="pointlist">
        <li>
        <h4><b>秀丸のインストールディレクトリに空白があるのは絶対ダメ!!</b></h4>
        <p><b><font color="red">"C:\Program Files\Hidemaru"など、<br>
        「秀丸をインストールしているディレクトリ」に空白文字が含まれているのは、最悪です。</font></b><br>
        様々なシーンで大きな苦労や徒労をするハメとなり、多くの不具合を抱えることとなります。<br>
        <br>
        「C:\tool\hidemaru」など、空白がなく、特別なUAC(ユーザーアクセスコントロール)もないディレクトリへのインストールが強く望まれます。<br>
        </p>
        <li>
        <h4><b>まずはファイルの解凍と配置</b></h4>
        <p>jLuaHMファイルを解凍し、以下のように配置しましょう。<br>
        秀丸をインストールしたフォルダが画像中の「Hidemaru」だとして、<br>
        そのサブフォルダにjLuaHMというフォルダ、そして、その中身が解凍ファイルの中身の形です。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_001.png"><br>
        </p>
        <li>
        <h4><b>jLua.exe本体もダウンロードする。</b></h4>
        <p>jLua.exe本体も <a href="?page=nobu_mod_the_snmod_methodref_lua_jlua">ここ</a> からダウンロードしましょう。<br>
        <br>
        以下のようにマクロと同じ位置に配置します。<br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_000.png"><br>
        </p>
        <li>
        <h4><b>秀丸上での設定 ～アウトプット枠～</b></h4>
        <p>もしも、秀丸で「アウトプット枠」を使ったことが無い、という人は。<br>
        アウトプット枠を表示しましょう。<br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_002.png"><br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_003.png"><br>
        </p>
        <li>
        <h4><b>秀丸上での設定 ～Luaファイルの作成～</b></h4>
        <p>Luaファイルの設定を行う最も簡単な方法は、まず、空でもなんでも良いので<br>
        Luaファイルを作成することです。<br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_004.png"><br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_005.png"> <br>
        <br>
        <b><font color="red">このLuaファイルを開いている状態</font></b>で、セッティングを行います。<br>
        <b>Luaファイルを開いていることが「極めて」重要です。</b><br>
        </p>
        <li>
        <h4><b>秀丸上での設定 ～Luaファイルの設定～</b></h4>
        <p>秀丸の「その他」⇒「ファイルタイプ別の設定」の項目で<br>
        「設定のリスト」を選び、「LUA言語」というタイプを新規に作成します。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_006.png"><br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_007.png"> <br>
        <br>
        今、ご自身で作成した「Lua言語」という設定項目が増えていますので、これを選択しましょう。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_008.png"> <br>
        <br>
        <br>
        これにより、今開いているファイルに対応する<b>拡張子、 <br>
        「***.lua」に紐付いて、 この「LUA言語」という設定が使われるようになりました。<br>
        <br>
        <font color="red">「***.lua」というファイルを開いた時だけ、 <br>
        「LUA言語」の設定が使われるようになったのです。</font><br>
        <br>
        </b> ここまでで一度「OK」を押しましょう。<br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_009.png"><br>
        </p>
        <li>
        <h4><b>秀丸上での設定 ～Luaファイルの強調表示の設定～</b></h4>
        <p>再び秀丸のメニューから「その他」⇒「ファイルタイプ別の設定」を押して、 「強調表示」という項目を押しましょう。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_009.png"><br>
        <br>
        そして、「読み込み」ボタンを押し、「参照」ボタンを押します。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_042.png"><br>

        <br>
        <br>
        読み込むファイルですが、<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_011.png"><br>
        <br>
        ご自身で、秀丸をインストールした場所の違いによって異なりますが、<br>
        「秀丸のディレクトリ」の下に、jLuaHMがあり、<br>
        さらにその下にhilightフォルダがあるはずですので、<br>
        その「jLua.token.hilight」を選択します。<br>
        <br>
        「開く」で選択します。<br>
        <br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_044.png"><br>
        <br>
        <br>
        この画面で<b><font color="red">「強調表示」「複数行の強調」「ツリー定義」</font>の３つにチェックが入った状態</b>にします。<br>
        手動でチェックを入れる必要があるので注意!!<br>
        <br>
        <br>
        「OK」を押します。<br>
        </p>
        <li>
        <h4><b>秀丸上での設定 ～Luaファイルの強調色の設定～</b></h4>
        <p>強調定義が適切でも、色が適切でなければ、見づらいだけです。<br>
        色を見やすくしましょう。<br>
        <br>
        再び秀丸のメニューから「その他」⇒「ファイルタイプ別の設定」を押して、<br>
        「デザイン」という項目を押しましょう。<br>
        <br>
        右下の「保存/読込」というボタンを押して、先ほどと同じ要領で その「jLua.color.hilight」を選択kします。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_032.png"><br>
        <br>
        <br>
        <b>読み込むのが「カラー」ですので「カラー」にチェック</b>を入れます。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_045.png"><br>
        <br>
        <br>
        デフォルトだとカーソルの行が非常に薄い色になって見づらくなっています。<br>
        <br>
        <b>そこで「カーソル行」</b>の項目を、以下のように設定しましょう。<br>
        <b>「背景色」モード</b>にチェックを付けます。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_034.png"><br>
        <br>
        「色」のボタンを押して、色は「灰色」を選択した後、「色の作成」によって、<br>
        白よりのほんのうっすら薄い灰色などにするとよいでしょう。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_035.png"><br>
        <br>
        <br>
        どんどん「OK」を押して、一度エディタの画面にもどりましょう。<br>
        </p>
        <li>
        <h4><b>秀丸上での設定 ～Luaファイルの自動辞書の設定～</b></h4>
        <p>再び秀丸のメニューから「その他」⇒「ファイルタイプ別の設定」を押して、<br>
        「単語補完」という項目を押しましょう。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_013.png"> <br>
        <br>
        上図のように<b>「自動表示」や「現在編集中のテキスト」「辞書ファイル」の３つにチェック</b>が入った状態とします。<br>
        <br>
        <br>
        「辞書ファイル」の項目の右側にある「...」ボタンを押して、<br>
        辞書ファイルとして、先ほどの「jLua.token.hilight」と同じ場所に<br>
        「jLua.token.dic」というファイルがありますので<br>
        それを選択します。<br>
        <br>
        ダイアログで選択する際に、<br>
        下図のように「ファイル名(N)」の欄に「*.dic」と入力しておかないと、<br>
        ファイルが出てこないので注意してください。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_014.png"><br>
        <br>
        <br>
        選択すると、下図のようになります。<br>
        <br>

        <img src="./other_soft/jlua/cnt_hidemaru_jlua_015.png"><br>
        <br>
        ここで、さらに「辞書ファイル」の下にある「詳細」ボタンを押します。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_016.png"><br>
        <br>
        <br>
        右側の「単語の種類」という項目で「カスタム」を選択します。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_017.png"><br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_018.png"><br>
        <br>
        <br>
        ここで、上図がみづらいですが「単語の途中の文字」というところで、<br>
        <br>
        「.」と「:」の２文字を連続で入力します。<br>
        <br>
        <font size="7"> .: </font>と２文字連続入力<br>
        <br>
        <br>
        これにより、「string.char」や「file:write」など、間に記号を挟んだ入力補完が可能となります。<br>
        また、上図にあるように「記号」にチェックが入っていなければ、チェックを入れましょう。<br>

        <br>
        何回か「OK」を押してゆき、以下の画面に戻ったら、<br>
        上の方に手をつけてきます。<br>
        <br>
        まずは、<b>表示方法を「リスト」</b>としましょう。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_046.png"><br>
        <br>

        今度は上の「詳細」ボタンを押します。<br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_020.png"><br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_019.png"><br>
        <br>
        <br>
        このあたりは、好み次第ですが、プログラムをする上では、<br>
        <b>「開始する文字数」は「2」文字 ツールチップに表示する最大個数は「9」個で良いでしょう。</b><br>
        <br>
        どんどん「OK」を押して、エディタの画面まで戻りましょう。<br>
        </p>
        <li>
        <h4><b>秀丸上での設定 ～Luaファイルの手動辞書のキー設定～</b></h4>
        <p>先ほどの設定は、「入力している最中に、自動で入力補完が出る」という機能に関する設定です。<br>
        それだけでは実際には不足しており、「自分のタイミングで入力候補を出す」という機能が書かせません。<br>
        <br>
        これを設定します。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_037.png"><br>
        <br>
        再び秀丸のメニューから「その他」⇒「キー割り当て」を押すと、以下のような画面となります。<br>
        <br>
        <b>「キー割り当て拡張」にチェック</b>を入れて、<br>
        <b>「Ctrl+Space」</b>を選び、コマンドとして<b>「その他編集」</b>を選択し、<br>
        リストから<b>「単語補完」</b>を選びます。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_036.png"><br>
        <br>
        これで「Ctrl+Space」で補完ができるようになりました。<br>
        これはVisual Studioなど、メジャーなWindows系開発環境と同じキーバインドです。<br>
        </p>
        <li>
        <h4><b>入力補完や強調表示を確認する</b></h4>
        <p>エディタ上で、「st」などと入力して、入力補完を確認してみしょう。<br>
        先ほど設定したように「２文字目」以降、入力補完が反応します。<br>
        <br>
        入力済の途中で自分で意識的に出す際には、「Ctrl+Space」を押します。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_023.png"><br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_038.png"><br>
        <br>
        </p>
        <li>
        <h4><b>秀丸上での設定 ～行番号～</b></h4>
        <p>秀丸の「行番号」の設定を変更します。<br>
        <br>
        再び秀丸のメニューから「その他」⇒「ファイルタイプ別の設定」を押して、<br>
        「体裁」の「詳細」という項目を押しましょう。<br>
        <br>
        そこの「行番号の計算方法」という項目を<b>「エディタ的」</b>とします。<br>
        <br>
        実際に、行番号といえば、普通のテキストだろうと、プログラムだろうと関係なく、<br>
        この「エディタ的」の設定による「行」を指します。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_041.png"><br>
        <br>
        <br>
        <br>
        又、「体裁」の「タブ」という項目を押しましょう。<br>
        <br>
        「8」という数値は極端ですので、「4」にしましょう。「4」が一般的です。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_054.png"><br>
        </p>
        <li>
        <h4><b>秀丸上での設定 ～秀丸上でLuaを実行～</b></h4>
        <p>秀丸上から、今編集しているファイルをLuaとして実行できるようにします。<br>
        <br>
        又、実行前のsyntaxチェックや、.exe へのリンクなども出来るようにします。<br>
        <br>
        秀丸のメニューから「マクロ」⇒「マクロの登録」を押します。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_024.png"><br>
        <br>
        <br>
        マクロの登録はどこでも開いている所に自由に登録してかまいません。<br>
        グループ名に「Lua ビルド」、マクロのタイトルに「Luaの実行」などとしましょう。<br>

        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_025.png"><br>
        <br>
        「...」ボタンを押して、「jLua.dofile.mac」のマクロを選択します。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_026.png"><br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_027.png"><br>
        <br>
        <br>
        同じ要領で、「Luaの文法チェック」といった項目を作成して、<br>
        「jLua.doCheck.mac」を選びましょう。<br>
        <br>

        <img src="./other_soft/jlua/cnt_hidemaru_jlua_030.png"><br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_029.png"><br>
        <br>
        同じ要領で、「Luaを.exe化」といった項目を作成して、<br>
        「jLua.doLink.mac」を選びましょう。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_031.png"><br>
        </p>
    </ul>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>以上で、全ての設定終了!!</h3>
    <p>なんと長かったのでしょう!!<br>
    しかし、全ての設定項目は終了しました。<br>
    </p>

</div>
<div class="content-box mb-3 content-lighten">
    <h3>使用練習</h3>
    <ul>
        <li>エディタ上で、適当に「print」などと入力した後、test.luaというファイル名で、<br>
        適当なディレクトリに保存してください。(半角スペースなどが入っていない場所)<br>
        <br>
        <li>以下のように打ってみましょう。<br>
        <div class="code"><pre class="brush:lua;">
print("Hello Lua World!")

</pre></div>
        <li>このプログラムをメニューから実行してみましょう。<br>
        <br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_050.png"><br>
        <br>

        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_051.png"><br>
        <br>
        <br>
        <br>

        <li>間違ったプログラムを実行してみましょう。<br>
        <div class="code"><pre class="brush:lua;">
print("Hello Lua World!")

a = a + 5
a = a / 0

</pre></div>
        ファイルを上書き保存して、再度、「Luaを実行」してみましょう。<br>
        <br>
        今度はエラーが「アウトプット枠」に出たようです。<br>
        狙いどおりです。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_052.png"><br>
        <br>
        ここで「F4キー」を押してみましょう。<br>
        「F4キー」は「アウトプット枠のジャンプできそうなフォーマットになっている行」へと飛ぶ、という意味です。<br>
        <br>
        F4キーを押した瞬間、アウトプット枠の行が青くなり、秀丸の該当のエラー行へとジャンプしました。 <br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_053.png"><br>
        <br>
        このように、「実行」し、「エラーがでたら、F4」でジャンプして修正、を繰り返し、<br>
        スクリプトを正しく修正していきます。<br>
        <br>
        <br>
        <li>次のように複数の関数を定義してみましょう。<br>
        <br>
        <div class="code"><pre class="brush:lua;">
function plus(x, y)
  return x+y
end

function minus(x, y)
  return x-y
end

function main()
  print(plus(1,2))
  print(minus(3,1))
end

main()
</pre></div>
        関数が複数ありますので、「アウトライン解析」を表示してみましょう。<br>
        アウトライン解析を表示することで、ソースをある程度自動にパースして、<br>
        そこをマウスで選択してジャンプできるようになります。<br>
        <br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_055.png"><br>
        <br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_056.png"><br>
        <br>
        <li>「Luaの文法チェック」については、「実行するまでもなくどう考えてもエラー」という項目について<br>
        割り出すことができます。<br>
        <br>
        いろいろとエラーのシチュエーションを作成し、エラーチェックししてみてください。<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_057.png"><br>
        <br>
        <br>
        <br>
        <li>「Luaの.exe化」については、今書いたLuaスクリプトを.exeにすることが出来ます。<br>
        他のマシンなどでも実行が可能です。(そこに秀丸やluaは必要ありません。)<br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_058.png"><br>
        <br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_059.png"><br>
        <br>
        <br>
        <img src="./other_soft/jlua/cnt_hidemaru_jlua_060.png" attr="noedge"><br>
        <br>
        <br>
    </ul>
</div>