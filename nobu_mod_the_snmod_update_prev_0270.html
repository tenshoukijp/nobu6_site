%(hilight)s
<div class="content-box mb-3 content-lighten">
    <h2><i class="fa fa-lightbulb-o fa-fw"></i>ScenarioModVer2 更新履歴 v2.6.5.0～v2.7.0.0</h2>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>v2.6.8.0 ⇒ v2.6.9.0</h3>
    <ul class="pointlist">
        <li>
            <h4>「家名」を表示しよとする直前に呼び出されるイベントハンドラを追加。</h4>
            <p>詳細は、「<a href="?page=nobu_mod_the_snmod_methodref_on_viewing_ie_name">On_家名表示直前</a>」</p>
    </ul>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>v2.6.7.7 ⇒ v2.6.8.0</h3>
    <p>バグ修正のみ。</p>
    <ul class="pointlist">
        <li>
            <h4>城情報列挙.h</h4>
            <p>
                「列挙::城::城絵背景::平野」の値が、「２」という間違った値となっていた。<br>
                正しくは「３」
            </p>
        <li>
            <h4>言葉遣い情報型.h(.cpp)</h4>
            <p>
                言葉遣い情報型.hの「％願います％」において、一部条件を満たすと、「ござった」という無関係なメッセージが出る不具合。<br>
                本来は「お願いいたす」が正しい。
            </p>
    </ul>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>v2.6.7.6 ⇒ v2.6.7.7</h3>
    <ul class="pointlist">
        <li>
            バグ修正のみ。
            <p>「列挙::家宝::家宝画像::***」について、一部番号が間違っていたのを修正。</p>
    </ul>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>v2.6.7.5 ⇒ v2.6.7.6</h3>
    <ul class="pointlist">
        <li>
            バグ修正のみ。
            <p>「季節::春」など、季節に関する列挙に関して名前空間を省略した記述が出来なくなっていた問題を修正。</p>
    </ul>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>v2.6.7.4 ⇒ v2.6.7.5</h3>
    <ul class="pointlist">
        <li>
            <h4>状況に応じて、武将の最大兵数を変化させるためのイベントハンドラを追加</h4>
            <p>詳細は、「<a href="?page=nobu_mod_the_snmod_methodref_on_request_bushou_custom_maxsoldier">On_武将最大兵数要求時</a>」</p>
        <li>
            <h4>型名が１つ変更</h4>
            <p>型名に統一性が無かったため、「<b>攻撃方法決定時型パラメタ</b>」という型名が「<span class="positive">攻撃方法決定時パラメタ型</span>」と変更された。</p>
    </ul>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>v2.6.7.3 ⇒ v2.6.7.4</h3>
    <ul class="pointlist">
        <li>
            <h4>戦争中の武将ユニットの移動残量を適切に変更することが可能となった。</h4>
            <p>詳細は、「<a href="?page=nobu_mod_the_snmod_methodref_on_change_movepower_in_battle">On_移動力残量変更時《戦争画面》</a>」</p>
        <li>
            <h4>戦争画面が終了した後、かつ、捕虜処理が始まる前のタイミングで実行されるイベントハンドラが追加された。</h4>
            <p>詳細は、「<a href="?page=nobu_mod_the_snmod_methodref_on_battlescreen_end">On_戦争画面終了()</a>」</p>
    </ul>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>v2.6.7.2 ⇒ v2.6.7.3</h3>
    <ul class="pointlist">
        <li>
            <h4>武将詳細画面の「〇〇隊」の「隊」が変更可能となった</h4>
            <p>詳細は、「<a href="?page=nobu_mod_the_snmod_methodref_on_butai_typename">On_部隊名表示直前</a>」</p>
    </ul>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>v2.6.7.0 ⇒ v2.6.7.2</h3>
    <ul class="pointlist">
        <li>
            <h4>列挙名前空間</h4>
            <p>
                今回の修正は主として、値比較の対象を全て「列挙」という名前空間に入れるものです。<br>
            </p>
            <div class="code">
                <pre class="brush:cpp;">
void カスタム::On_シナリオ大名選択直前(int シナリオ番号) {
    int iBushouIDA = Get_武将番号【配列用】(列挙::武将::顔番号::織田信長);

    int iBushouIDB = Get_武将番号【配列用】(顔番号::織田信長); // 衝突しにいくいであろうところまでは、名前空間がすでにusing済み

    p家宝情報[列挙::家宝::家宝配列番号::ルソン壺].家宝画像 = 列挙::家宝::家宝画像::花入;

    p家宝情報[家宝配列番号::ルソン壺].家宝画像 = 家宝画像::花入; // 衝突しにいくいであろうところまでは、名前空間がすでにusing済み

    p城情報[列挙::城::城配列番号::二条城].兵質 = 列挙::城::兵質::悪;

    p城情報[城配列番号::二条城].兵質 = 兵質::悪;  // 衝突しにいくいであろうところまでは、名前空間がすでにusing済み
}
</pre>
            </div>
        <li>
            <h4><span class="keyword">Set_コマンド行動力設定関数</span>の名称変更</h4>
            <p><span class="keyword">Set_コマンド行動力設定</span>という関数の名称、及び、使用方法が変化しました。</p>
            <div class="code">
                <pre class="brush:cpp;">
Set_コマンド行動力(メイン画面::行動力コマンド名::手切, 10);
</pre>
            </div>
            <p>のような形となりました。</p>
    </ul>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>v2.6.6.9 ⇒ v2.6.7.0</h3>
    <ul class="pointlist">
        <li>
            <h4>適正→適性へ</h4>
            <p>今回の修正は主として、不適正なフィールド名の変更となります。</p>
            <p>
                <b>
                    <font color="red">長らく放置されていた「戦闘適正」といった「適性」を「適正」と</font>
                </b><br>
                間違って表記されていた<font color="red">全ての箇所が「適性」</font>と修正された。<br>
            </p>
            <p>
                この変更により多くのコンパイルエラーを引き起こす可能性があるので、<br>
                手持ちのソースの「適正」→「適性」と 一喝で置き換えるなどして対処してください。<br>
            </p>
        <li>
            <h4>混乱状態::挑発→混乱状態::挑発混乱へ</h4>
            <p>混乱状態::挑発は名称が紛らわしいため、<span class="keyword">混乱状態::挑発混乱</span>と命名が変更となった。</p>
    </ul>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>v2.6.6.8 ⇒ v2.6.6.9</h3>
    <ul class="pointlist">
        <li>
            <h4>官位所有者や家宝所有者を変更する際、能力変更も一緒に行うための関数</h4>
            <ul class="arrowlist">
                <li><span class="keyword">Set_官位所有者変更</span>
                <li><span class="keyword">Set_家宝所有者変更</span>
            </ul>
            <p>
                といった関数が追加された。<br>
            </p>
            <p>
                これら所有者の変更には、常に武将の能力の変更が伴うため、<br>
                これまではメンドクサイ処理を自身で記述する必要があったが、関数として提供されたこととなる。<br>
            </p>
        <li>
            <h4>家宝や官位による上昇値を除いた値取得のための関数</h4>
            <ul class="arrowlist">
                <li><span class="keyword">Get_元最大政才</span>
                <li><span class="keyword">Get_元最大戦才</span>
                <li><span class="keyword">Get_元最大智才</span>
                <li><span class="keyword">Get_元野望</span>
                <li><span class="keyword">Get_元魅力</span>
            </ul>
            <p>といった、武将の能力のうち、家宝や官位による上昇幅を覗いた値を得るための専用の関数が追加された。</p>
        <li>
            <h4>その他</h4>
            <ul class="arrowlist">
                <li><span class="keyword">Get_家宝番号【配列用】</span>
            </ul>
            <p>という、家宝名から家宝番号【配列用】を逆引きするための関数が追加された。</p>
    </ul>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>v2.6.6.7 ⇒ v2.6.6.8</h3>
    <ul class="pointlist">
        <li>
            <h4><span class="keyword">戦国名城物語型＆ カスタム::On_戦国名城物語要求時(int 城番号)</span></h4>
            <p>というイベントハンドラが追加された。</p>
            <p>詳細は、「<a href="?page=nobu_mod_the_snmod_methodref_on_viewing_castle_retsuden">こちら</a>」</p>
    </ul>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>v2.6.5.7 ⇒ v2.6.6.7</h3>
    <ul class="pointlist">
        <li>
            <h4><span class="keyword">戦国武将列伝型＆ カスタム::On_戦国武将列伝要求時(int 武将番号, int 顔番号)</span></h4>
            <p>
                というイベントハンドラが追加された。<br>
            </p>
            <p>詳細は、「<a href="?page=nobu_mod_the_snmod_methodref_on_viewing_bushou_retsuden">こちら</a>」</p>
        <li>
            <h4><span class="keyword">戦国名物事典型＆ カスタム::On_戦国名物事典要求時(int 家宝番号)</span></h4>
            <p>
                というイベントハンドラが追加された。<br>
            </p>
            <p>詳細は、「<a href="?page=nobu_mod_the_snmod_methodref_on_viewing_kahou_retsuden">こちら</a>」</p>
    </ul>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>v2.6.5.5 ⇒ v2.6.5.7</h3>
    <ul class="pointlist">
        <li>
            <h4><span class="keyword">エンディング情報型＆ カスタム::On_エンディング判定時(int 大名番号)</span></h4>
            <p>
                というイベントハンドラが追加された。<br>
            </p>
            <p>詳細は、「<a href="?page=nobu_mod_the_snmod_methodref_on_ending_cond">こちら</a>」</p>
        <li>
            <h4>カスタム条件として、<span class="keyword">OR条件::戦争::鉄砲不可</span></h4>
            <p>が追加された。</p>
            <p>詳細は、「<a href="?page=nobu_mod_the_snmod_methodref_on_custom_teppou_huka">こちら</a>」</p>
    </ul>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>v2.6.5.3 ⇒ v2.6.5.5</h3>
    <ul class="pointlist">
        <li>
            <h4>使用対象の全ての「構造体」「関数」などに対して、「入力補完用のコメント」を付記</h4>
            <p>
                使用されそうな関数や型に関しては、原則全て「Summaryタイプ」のコメントを付記した。<br>
                (C#などで使われるVisualStudio専用スタイルのコメント)<br>
            </p>
            <p>便利に機能するはずである。</p>
    </ul>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>v2.6.5.2 ⇒ v2.6.5.3</h3>
    <ul class="pointlist">
        <li>
            <h4>mrubyの除去</h4>
            <p>
                ScenarioModからmruby部分に関するすべての機能がカットされた。<br>
                mrubyのモジュールが、「Visual Studio の異なるバージョン間」で互換性が保てないため。<br>
            </p>
            <p>
                ScenarioModでは、外部テキストスクリプトとしては<span class="keyword">Lua</span>を中心に据えているのでそちらを利用してください。<br>
                又、<a href="?page=nobu_mod_the_snmod_methodref_ironpython_initIronPythonMod">IronPythonMod</a>も提供しています。
            </p>
    </ul>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>v2.6.5.2 ⇒ v2.6.5.2</h3>
    <ul>
        <li><span class="keyword"><a href="?page=nobu_mod_the_snmod_methodref_on_viewing_position">カスタム::On_身分名表示直前(int 武将番号, int 身分)</a></span>
        <li>
            <span class="keyword"><a href="?page=nobu_mod_the_snmod_methodref_on_viewing_bushoustate">カスタム::On_状態名表示直前(int 武将番号, int 状態)</a></span>
            <p>の２つのカスタム条件が追加された。</p>
    </ul>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>v2.6.5.1 ⇒ v2.6.5.2</h3>
    <ul class="pointlist">
        <li>
            <h4><span class="keyword">Set_武将誕生</span>の仕様変更</h4>
            <p>
                <span class="keyword">Set_武将誕生</span>の関数が、「失敗」した際の返り値が、意図せず0xFFFFになっていたのを修正た。<br>
                <span class="negative">正しくは該当関数に付記しているコメント通り-1</span>である。
            </p>
        <li>
            <h4><span class="keyword">LUA::例外型</span>の型を変更</h4>
            <p>
                「LUA::例外型」や「MRUBY::例外型」はこれまで「int型」であったが、「std::exception」の「派生型」となった。<br>
                よって標準のC++例外型として扱うことが可能となった。
            </p>
    </ul>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>v2.6.5.0 ⇒ v2.6.5.1</h3>
    <ul class="pointlist">
        <li>
            <h4>独自ファイルへの拡張セーブデータ簡易機能</h4>
            <p>
                「独自のファイル」に拡張データをセーブするための簡易機能が追加された。<br>
            </p>
            <p>
                今回提供の簡易機能は、別ファイル名(自分で名前を付ける)に別途拡張データをセーブするものとなります。<br>
            </p>
            <p>特に名前を変更しなかった場合は、「<b>SAVEDAT.N6PEX</b>」というファイルに、拡張部分のデータが格納されるようになります。</p>
        <li>
            <h4>TSModのセーブデータの拡張との違い</h4>
            <p>
                TSModでは、セーブデータファイル(SAVEDATA.N6P)そのものに「拡張データ」を持っています。<br>
                この一部分を利用して、ScenarioModには「Get_フラグ()」や「Set_フラグ()」といった関数が提供されています。<br>
            </p>
            <p>
                しかし、セーブやロードと同時に、ある程度まとまった量の「独自のデータ」の保存や復元を行いたいという場合、<br>
                ScenarioModへと提供されている「フラグの機能」では、まかないないため 「各自が全て自前」でその機構を記述する必要があります。<br>
            </p>
            <p>
                今回はそれをある程度自動化し、短いソース記述で目的を達成する、という機能となります。<br>
            </p>
        <li>
            <h4>カスタム駆動関数.cpp</h4>
            <div class="code">
                <pre class="brush:cpp;">
// 最終的にセーブしたいデータの「構造体(あるいはクラス)」を定義する。名前は自由。
// 構造体内のメンバフィールドの「型」として使えるのは「プリミティブ型」及び「ポインタ」である。
// あくまで「メモリブロック」として保存される、
// 何ビット目が0か1か、それだけが考慮対象である。
// よって一度保存した後に、「構造体のサイズ」や「フィールドの並び」を変更すると、読み込みデータが瓦解する。
// これを防止するため、下の例のように「予備領域」を事前に持っておき、「予備領域」を切り崩しながら、新たなフィールドを追加する。
//------------保--存--対--象------------------------------------------------------------------
struct my拡張構造体 {
    int a;
    char sz[12]; // string型を使うのは許されない。string型はプリミティブ型ではないので、Visual Stduioのライブラリのセットのバージョンが変わるだけで「メモリブロック上でのサイズ」が変化してしまうため。
                 // 「C++ プリミティブ型」などでググって使える「型」を検索すること。
    byte 予備[40]; // 予備データ。
};
//--------------------------------------------------------------------------------------------

// 緑の所は構造体の名前を指定する。青の所は自由な名前をつければ良い。
拡張セーブデータ情報型&lt;my拡張構造体&gt; my拡張セーブデータ;

// この行を記述しておくと、後々変数に短い名前でアクセスできる。
// 下記の例では、「my拡張セーブデータ.拡張パラメタ」に「pex」という別名で参照できるようにしている。
auto &amp;pex = my拡張セーブデータ.拡張パラメタ;


// 以下は「ScenaroModの既存のイベントハンドラ」に記述を足す。

void カスタム::On_トップメニュー表示時() {
    my拡張セーブデータ.Do_メモリクリア();
}

void カスタム::On_セーブデータ読込時(int スロット番号, string セーブファイル名) {
    my拡張セーブデータ.On_セーブデータ読込時(スロット番号, セーブファイル名); // 拡張データを独自のファイルからロード
}

void カスタム::On_セーブデータ保存時(int スロット番号, string セーブファイル名) {
    my拡張セーブデータ.On_セーブデータ保存時(スロット番号, セーブファイル名); // 拡張データを独自のファイルにセーブ
}
</pre>
            </div>
            <p>
                以上で準備が完了。<br>
            </p>
            <p>あとは、</p>
            <div class="code">
                <pre class="brush:cpp;">
void カスタム::On_軍団ターン変更《メイン画面》(int 軍団番号) {
    pex.a = 30;
    string s = &quot;あああ&quot;;
    strcpy( pex.sz, s.c_str() ); // string型ではなく、char配列なので、strcpyを使う必要がある。
}
</pre>
            </div>
            <p>
                などと自由に使える。<br>
            </p>
            <p>
                これはセーブのタイミングで、セーブされ、ロードのタイミングで、読み込まれる。 <br>
            </p>
        <li>
            <h4>拡張用のセーブデータを別途作成する例</h4>
            <p>
                多くのデータ項目に拡張データを持つような場合、<br>
                例えば 「拡張セーブデータ.h」(ファイル名自由)<br>
                といったファイル名で自分で好きなように下のように定義して、
            </p>
            <div class="code">
                <pre class="brush:cpp;">
namespace ユーザー {

    // 武将１人分の拡張パラメタ
    struct 武将情報EX型 {
        int a;                    // 4バイトの数値
        int b;                    // 4バイトの数値
        int c;                    // 4バイトの数値
        char 渾名[15];            // 14バイト+NULLの文字列(もしくは15バイトのデータ)

        byte 予備[40];            // 40バイトを保持。将来データを増やした時に、ここから削って増やす。合計のバイト数をかならずぴったり合わせる。
    };

    // 大名家１つ分の拡張パラメタ
    struct 大名情報EX型 {
        int a;                    // 4バイトの数値
        int b;                    // 4バイトの数値
        byte 予備[20];            // 予備として20バイトを保持。将来データを増やした時に、ここから削って増やす。合計のバイト数をかならずぴったり合わせる。
    };

    // 軍団１つ分の拡張パラメタ
    struct 軍団情報EX型 {
        int a;                    // 4バイトの数値
        int b;                    // 4バイトの数値
        byte 予備[20];            // 予備として20バイトを保持。将来データを増やした時に、ここから削って増やす。合計のバイト数をかならずぴったり合わせる。
    };

    // 城１つ分の拡張パラメタ
    struct 城情報EX型 {
        int a;                    // 4バイトの数値
        int b;                    // 4バイトの数値
        byte 予備[20];            // 予備として20バイトを保持。将来データを増やした時に、ここから削って増やす。合計のバイト数をかならずぴったり合わせる。
    };

    // 家宝１つ分の拡張パラメタ
    struct 家宝情報EX型 {
        int a;                    // 4バイトの数値
        int b;                    // 4バイトの数値
        byte 予備[20];            // 予備として20バイトを保持。将来データを増やした時に、ここから削って増やす。合計のバイト数をかならずぴったり合わせる。
    };

    // 官位１つ分の拡張パラメタ
    struct 官位情報EX型 {
        int a;                    // 4バイトの数値
        int b;                    // 4バイトの数値
        byte 予備[20];            // 予備として20バイトを保持。将来データを増やした時に、ここから削って増やす。合計のバイト数をかならずぴったり合わせる。
    };

    struct 予備情報EX型 {
        int 予備[100];            // 予備として100バイトを保持。将来データを増やした時に、ここから削って増やす。合計のバイト数をかならずぴったり合わせる。
    };

    // １つのセーブスロットに対応する拡張データ
    struct 自分の拡張セーブデータ型 {
        武将情報EX型 p武将情報[最大数::武将情報::配列数];   // 武将の拡張データ。p武将情報の配列と同じ番号で良い。
        大名情報EX型 p大名情報[最大数::大名情報::配列数];   // 大名の拡張データ。p大名情報の配列と同じ番号で良い。
        軍団情報EX型 p軍団情報[最大数::軍団情報::配列数];   // 軍団の拡張データ。p軍団情報の配列と同じ番号で良い。
        城情報EX型   p城情報[最大数::城情報::配列数];       // 城の拡張データ。p城情報の配列と同じ番号で良い。
        家宝情報EX型 p家宝情報[最大数::家宝情報::配列数];   // 家宝の拡張データ。p家宝情報の配列と同じ番号で良い。
        官位情報EX型 p官位情報[最大数::官位情報::配列数];   // 官位の拡張データ。p官位情報の配列と同じ番号で良い。
        予備情報EX型 p汎用情報;                             // これら以外の何か汎用のデータ。
    };
}

</pre>
            </div>
            <p>といったファイル名で保存し、 カスタム駆動関数.cpp</p>
            <div class="code">
                <pre class="brush:cpp;">
#include &quot;拡張セーブデータ.h&quot;

拡張セーブデータ情報型&lt;ユーザー::自分の拡張セーブデータ型&gt; my拡張セーブデータ;

auto &amp;pex = my拡張セーブデータ.拡張パラメタ;

// 後は、同じ

</pre>
            </div>
            <p>
                といった感じにすれば良いだろう。<br>
            </p>
            <p>
                あとは、短い名前として用意した「pex」で値に自由にアクセス出来る。<br>
            </p>
            <div class="code">
                <pre class="brush:cpp;">
void カスタム::On_相場変更直前() {
    int iBushouID = Get_武将番号【配列用】(顔番号::武田晴信); // 武田信玄
    if ( 0&lt;=iBushouID &amp;&amp; iBushouID &lt; 最大数::武将情報::配列数) {
        デバッグ出力 &lt;&lt; pex.p武将情報[iBushouID].渾名 &lt;&lt; endl;
    }
}
</pre>
            </div>
    </ul>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>v2.6.2.9 ⇒ v2.6.5.0</h3>
    <ul class="pointlist">
        <li>
            <h4>Visual Studio 2013以上を必須環境へ</h4>
            <p>
                天翔記.jpのほぼ全てのプロジェクトがVisual Studio 2013へと更新されました。<br>
            </p>
            <p>
                これに伴い、<b>ScenaroModも Visual Studio 2013 Community 以上のバージョン</b>を必須バージョンとします。<br>
                (今回の変更により、事実上、ScenarioModの開発には、Windows7以上のOSが必須となります。)
            </p>
    </ul>
</div>